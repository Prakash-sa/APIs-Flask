<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AJAX Log Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        #logs { border: 1px solid #ccc; padding: 1rem; height: 300px; overflow-y: auto; background: #f9f9f9; }
        li { font-family: "Courier New", monospace; }
        form { margin-top: 1rem; display: flex; gap: 0.5rem; }
    </style>
</head>
<body>
    <h1>AJAX Polling Demo</h1>
    <p>This page polls <code>/logs/latest</code> every 3 seconds and renders the newest log entries.</p>
    <ul id="logs"></ul>

    <form id="log-form">
        <input type="text" id="message" placeholder="New log message" required size="40" />
        <button type="submit">Append</button>
    </form>

    <script>
        const logsList = document.getElementById("logs");
        const form = document.getElementById("log-form");
        const messageInput = document.getElementById("message");

        async function loadLogs() {
            const response = await fetch("/logs/latest?limit=50");
            const data = await response.json();
            logsList.innerHTML = "";
            data.entries.forEach(line => {
                const li = document.createElement("li");
                li.textContent = line;
                logsList.appendChild(li);
            });
        }

        async function appendLog(event) {
            event.preventDefault();
            const message = messageInput.value;
            await fetch("/logs", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({message})
            });
            messageInput.value = "";
            loadLogs();
        }

        form.addEventListener("submit", appendLog);
        loadLogs();
        setInterval(loadLogs, 3000);
    </script>
</body>
</html>
